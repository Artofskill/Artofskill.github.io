<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Депозит и Cложный процент</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        :root{--main:#00f5ff;--accent:#ff00ff;--bg:#0f0f23}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:var(--bg);color:#fff;min-height:100vh;padding:15px 10px}
        .container{max-width:1400px;margin:0 auto;background:rgba(255,255,255,0.04);border-radius:20px;padding:20px 15px;box-shadow:0 15px 40px rgba(0,0,0,0.6);backdrop-filter:blur(12px)}
        h1{text-align:center;font-size:2.4em;margin-bottom:20px;background:linear-gradient(90deg,var(--main),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .header{text-align:center;margin-bottom:30px}
        .refresh-btn{
            background:linear-gradient(90deg,var(--main),var(--accent));color:#000;border:none;padding:14px 40px;border-radius:50px;font-size:1.3em;cursor:pointer;font-weight:bold;
            box-shadow:0 8px 25px rgba(0,0,0,0.5);transition:all 0.3s;position:relative;overflow:hidden
        }
        .refresh-btn:hover{transform:translateY(-3px)}
        .refresh-btn:disabled{opacity:0.7;cursor:not-allowed}
        #loader{
            position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,15,35,0.95);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;
            transition:opacity 0.5s;opacity:0;pointer-events:none
        }
        #loader.active{opacity:1;pointer-events:all}
        .loader-spinner{
            width:80px;height:80px;border:8px solid rgba(0,245,255,0.3);border-top:8px solid var(--main);border-radius:50%;animation:spin 1.2s linear infinite;margin-bottom:30px
        }
        @keyframes spin{to{transform:rotate(360deg)}}
        .loader-text{font-size:1.6em;font-weight:600;background:linear-gradient(90deg,var(--main),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:40px 0}
        .stat{background:rgba(255,255,255,0.08);border-radius:16px;padding:20px;text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.4);transition:0.3s}
        .stat:hover{transform:translateY(-8px)}
        .stat h3{font-size:1em;opacity:0.9;margin-bottom:8px}
        .stat .value{font-size:2.2em;font-weight:900;background:linear-gradient(90deg,var(--main),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .progress-container{margin:50px 0 30px;text-align:center}
        .progress-label{font-size:1.8em;margin-bottom:15px}
        .progress-bar{height:50px;background:rgba(255,255,255,0.1);border-radius:25px;overflow:hidden;position:relative;box-shadow:inset 0 5px 15px rgba(0,0,0,0.4)}
        .progress-fill{height:100%;width:0;background:linear-gradient(90deg,var(--main),var(--accent));transition:width 1.8s ease}
        .progress-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2em;font-weight:bold}
        .circle-progress{width:260px;height:260px;margin:40px auto;position:relative}
        .circle-progress svg{width:100%;height:100%;transform:rotate(-90deg)}
        .circle-progress circle{fill:none;stroke:#333;stroke-width:22}
        .circle-progress .bar{stroke:url(#grad);stroke-width:22;stroke-linecap:round;transition:stroke-dasharray 1.8s}
        .circle-progress .text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:3.2em;font-weight:bold;background:linear-gradient(90deg,var(--main),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .table-wrapper{overflow-x:auto;-webkit-overflow-scrolling:touch;margin-top:40px}
        table{width:100%;border-collapse:collapse;background:rgba(255,255,255,0.05);border-radius:12px;overflow:hidden}
        th,td{padding:10px 8px;text-align:center;font-size:0.9em}
        th{background:linear-gradient(90deg,var(--main),var(--accent));color:#000;font-weight:bold}
        tr{border-bottom:1px solid rgba(255,255,255,0.08)}
        tr:hover{background:rgba(255,255,255,0.08)}
        @media(max-width:768px){
            h1{font-size:2em}
            .stats{grid-template-columns:1fr 1fr}
            .circle-progress{width:200px;height:200px}
            .circle-progress .text{font-size:2.5em}
        }
        @media(max-width:480px){
            .stats{grid-template-columns:1fr}
        }
    </style>
</head>
<body>

<div id="loader">
    <div class="loader-spinner"></div>
    <div class="loader-text" id="loaderText">Запрашиваю данные...</div>
</div>

<div class="container">
    <h1> Депозит и Cложный процент</h1>
    <div class="header">
        <button class="refresh-btn" onclick="loadData()" id="refreshBtn">Обновить</button>
    </div>

    <div id="stats" class="stats"></div>

    <div class="progress-container">
        <div class="progress-label">До цели</div>
        <div class="progress-bar">
            <div class="progress-fill" id="totalFill"></div>
            <div class="progress-text" id="totalText">0%</div>
        </div>
    </div>

    <div class="circle-progress">
        <svg><circle cx="130" cy="130" r="110"></circle><circle class="bar" cx="130" cy="130" r="110" stroke-dasharray="0 691"></circle></svg>
        <div class="text">0%</div>
    </div>

    <div class="table-wrapper">
        <table id="levelsTable">
            <thead><tr><th>LVL</th><th>Депо</th><th>Цель</th><th>Текущий статус</th><th>Current LVL Profit</th><th>Achieved</th><th>Дата</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<svg style="position:absolute;width:0;height:0">
    <defs>
        <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#00f5ff"/>
            <stop offset="100%" stop-color="#ff00ff"/>
        </linearGradient>
    </defs>
</svg>

<script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTGolX0bo1z7rTJGbSN7TjPpWtUtS-lB35107OB71d5nULSaNbo-9imyWutPdbUuhxpxtRhthfHB1Q9/pub?gid=266237619&single=true&output=csv';
    const proxy = 'https://corsproxy.io/?'; // ← ЭТО САМОЕ ВАЖНОЕ ИЗМЕНЕНИЕ
    const url = proxy + encodeURIComponent(csvUrl);

    function setLoader(text, active = true) {
        document.getElementById('loaderText').textContent = text;
        document.getElementById('loader').classList.toggle('active', active);
    }

    function loadData() {
        const btn = document.getElementById('refreshBtn');
        btn.disabled = true;
        setLoader('Запрашиваю данные...', true);

        fetch(url)
            .then(r => { setLoader('Получаю ответ...'); if (!r.ok) throw new Error('Network error'); return r.text(); })
            .then(text => { setLoader('Обрабатываю данные...'); return new Promise(res => setTimeout(() => res(text), 300)); })
            .then(text => {
                const parsed = Papa.parse(text, { header: false, skipEmptyLines: true });
                const rows = parsed.data;

                const dataRow = rows[3];
                const parse = s => parseFloat((s||'').toString().replace(/[^0-9,]/g,'').replace(',','.')) || 0;

                const currentDep = parse(dataRow[2]);
                const neededProfit = parse(dataRow[3]);
                const nextGoal = parse(dataRow[4]);
                const totalGoal = parse(dataRow[5]);

                const totalPercent = totalGoal > 0 ? (currentDep / totalGoal) * 100 : 0;
                const format = n => '$' + n.toLocaleString('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                document.getElementById('stats').innerHTML = `
                    <div class="stat"><h3>Тек. депозит</h3><div class="value">${format(currentDep)}</div></div>
                    <div class="stat"><h3>Требуемая прибыль</h3><div class="value">${format(neededProfit)}</div></div>
                    <div class="stat"><h3>Следующая цель</h3><div class="value">${format(nextGoal)}</div></div>
                    <div class="stat"><h3>Общая цель</h3><div class="value">${format(totalGoal)}</div></div>
                `;

                document.getElementById('totalFill').style.width = Math.min(totalPercent, 110) + '%';
                document.getElementById('totalText').textContent = totalPercent.toFixed(1) + '%';

                const circ = 2 * Math.PI * 110;
                const dash = (totalPercent / 100) * circ;
                document.querySelector('.bar').style.strokeDasharray = `${dash} ${circ}`;
                document.querySelector('.circle-progress .text').textContent = totalPercent.toFixed(1) + '%';

                const tbody = document.querySelector('#levelsTable tbody');
                tbody.innerHTML = '';
                for (let i = 7; i < rows.length; i++) {
                    const r = rows[i];
                    if (!r || r.length < 7) continue;
                    const achieved = r[5] === 'Да' ? '<span style="color:#00ff9d;font-weight:bold">Да</span>' : '';
                    tbody.innerHTML += `<tr><td>${r[0]||''}</td><td>${r[1]||''}</td><td>${r[2]||''}</td><td><strong>${r[3]||''}</strong></td><td>${r[4]||''}</td><td>${achieved}</td><td>${r[6]||''}</td></tr>`;
                }

                setLoader('Готово!', false);
                btn.disabled = false;
            })
            .catch(err => {
                console.error(err);
                setLoader('Ошибка загрузки. Попробуй ещё раз.', false);
                btn.disabled = false;
            });
    }

    loadData();
</script>
</body>
</html>
