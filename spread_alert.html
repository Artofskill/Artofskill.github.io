<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spread Alert by Artofskill</title>
    <!-- –î–æ–±–∞–≤–ª—è–µ–º Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ (–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #0d1117; 
            color: #c9d1d9; 
            margin: 0; 
            padding: 0;
            scroll-behavior: smooth;
        }
        h1 { 
            text-align: center; 
            color: #58a6ff; 
            font-size: 1.8em; 
            margin: 15px 0 20px 0; 
        }

        /* –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ô –≤–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫ */
        .header-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: #0d1117;
            box-shadow: 0 4px 20px rgba(0,0,0,0.8);
        }

        /* –ë–ª–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –≤–≤–µ—Ä—Ö—É */
        .time-block {
            background: #161b22;
            height: 100px;
            margin: 0 15px 15px 15px;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
            position: relative;
        }

        .ntp-time {
            font-size: 3.5em;
            font-weight: bold;
            color: #ffa657;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 10px rgba(255, 165, 87, 0.5);
            margin-bottom: 5px;
        }

        /* –ö–Ω–æ–ø–∫–∞ –¥–æ–º–æ–π —Å–ª–µ–≤–∞ */
        .home-btn {
            position: absolute;
            top: 10px;
            left: 15px;
            background: #56d364;
            color: black;
            border: none;
            border-radius: 8px;
            padding: 5px 15px;
            font-size: 0.8em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .home-btn:hover {
            background: #7ffe94;
        }

        /* –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ */
        .refresh-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #58a6ff;
            color: black;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 0.8em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .refresh-btn:hover {
            background: #79c0ff;
        }

        /* –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞ —Ñ–∞–Ω–¥–∏–Ω–≥–∞ */
        .funding-timer {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 5px;
            padding: 5px 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }

        .funding-timer.green {
            color: #56d364;
            background: rgba(86, 211, 100, 0.1);
            box-shadow: 0 0 10px rgba(86, 211, 100, 0.3);
        }

        .funding-timer.red {
            color: #ff7b72;
            background: rgba(255, 123, 114, 0.1);
            box-shadow: 0 0 10px rgba(255, 123, 114, 0.3);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –æ—Ç—Å—Ç—É–ø–æ–º –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        .main-content {
            margin-top: 180px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
            padding-bottom: 20px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏ */
        .wrapper { 
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            width: 100%;
            margin: 0;
            padding: 0 15px;
            box-sizing: border-box;
        }

        /* –£–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –±–ª–æ–∫–æ–≤ –¥–æ 800px */
        .block { 
            background: #161b22; 
            padding: 18px;
            border-radius: 16px; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.6); 
            height: 800px; /* –ò–∑–º–µ–Ω–µ–Ω–æ —Å 900px –Ω–∞ 800px */
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        /* –ë–ª–æ–∫ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ TradingView */
        .chart-block { 
            background: #161b22; 
            padding: 18px;
            border-radius: 16px; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.6); 
            height: 700px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            margin: 15px;
            grid-column: 1 / -1;
        }

        /* –ù–û–í–´–ô: –ë–ª–æ–∫ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ Chart.js */
        .chartjs-block {
            background: #161b22;
            padding: 18px;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
            height: 600px; /* –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ */
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            margin: 15px;
            grid-column: 1 / -1; /* –ù–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
        }

        .block h2 { 
            color: #ffa657; 
            margin: 0 0 12px 0; 
            font-size: 1.2em;
            text-align: center;
        }

        .chart-block h2 { 
            color: #58a6ff; 
            margin: 0 0 15px 0; 
            font-size: 1.3em;
            text-align: center;
        }

        .chartjs-block h2 {
            color: #7ffe94;
            margin: 0 0 15px 0;
            font-size: 1.3em;
            text-align: center;
        }

        /* –Ø–∫–æ—Ä–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .anchor {
            position: relative;
            top: -200px;
            visibility: hidden;
        }

        input, button, select { 
            padding: 8px 10px;
            font-size: 14px;
            border-radius: 8px; 
            border: none; 
            margin: 4px 0; 
        }
        input { 
            background: #21262d; 
            color: white; 
            text-align: center; 
            width: 100%; 
        }
        select {
            background: #21262d;
            color: white;
            width: 100%;
        }
        button { 
            background: #58a6ff; 
            color: black; 
            font-weight: bold; 
            cursor: pointer; 
        }

        .funding-result {
            margin-top: 12px;
            padding: 15px;
            background: #21262d;
            border-radius: 12px;
            font-size: 1.0em;
            line-height: 1.5;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .funding-line {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 0 5px;
        }

        .funding-label {
            color: #ffa657;
            font-weight: 600;
            flex: 1;
        }

        .funding-value {
            font-weight: bold;
            flex: 1;
            text-align: right;
        }

        .funding-usdt {
            color: #8b949e;
            font-size: 0.85em;
            margin-top: 2px;
            text-align: right;
        }

        .funding-positive { color: #56d364; }
        .funding-negative { color: #ff7b72; }

        .funding-summary {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #30363d;
            font-size: 1.0em;
            font-weight: bold;
            text-align: center;
        }

        button:hover { background: #79c0ff; }
        button.stop { background: #ff4444; }
        button.stop:hover { background: #ff6666; }

        .content { 
            flex: 1; 
            background: #21262d; 
            border-radius: 12px; 
            padding: 15px;
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            font-size: 1.0em;
            line-height: 1.5;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ TradingView */
        .chart-container {
            flex: 1;
            background: #21262d;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        #tradingview-chart {
            width: 100%;
            height: 100%;
            min-height: 600px;
        }

        /* –ù–û–í–´–ô: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ Chart.js */
        .chartjs-container {
            flex: 1;
            background: #21262d;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        #spread-chart {
            width: 100%;
            height: 100%;
        }

        /* –ö–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ */
        .chart-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .chart-btn {
            background: #58a6ff;
            color: black;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chart-btn:hover {
            background: #79c0ff;
        }

        .chart-btn.update {
            background: #56d364;
        }

        .chart-btn.update:hover {
            background: #7ffe94;
        }

        .chart-btn.clear {
            background: #ff7b72;
        }

        .chart-btn.clear:hover {
            background: #ff9999;
        }

        /* –°—á–µ—Ç—á–∏–∫ —Ç–æ—á–µ–∫ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ */
        .chart-counter {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
            color: #8b949e;
        }

        /* Floating Button (–ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞) */
        .floating-menu {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: #58a6ff;
            color: black;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            text-align: center;
            padding: 5px;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .floating-btn.live {
            background: #ffa657;
        }

        .floating-btn.live:hover {
            background: #ffc489;
        }

        .floating-btn.history {
            background: #7ffe94;
        }

        .floating-btn.history:hover {
            background: #a8ffbb;
        }

        .floating-btn.tradingview {
            background: #58a6ff;
        }

        .floating-btn.tradingview:hover {
            background: #79c0ff;
        }

        .floating-btn.active {
            transform: scale(1.15);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .floating-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            right: 70px;
            top: 50%;
            transform: translateY(-50%);
            background: #161b22;
            color: #c9d1d9;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            pointer-events: none;
            border: 1px solid #30363d;
        }

        .floating-btn:hover::after {
            opacity: 1;
            visibility: visible;
            right: 75px;
        }

        /* –ï–¥–∏–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤ */
        .ticker-big { 
            font-size: 1.5em; 
            font-weight: 700; 
            color: #58a6ff; 
            margin-bottom: 8px; 
        }
        
        .spread-big { 
            font-size: 2.2em; 
            font-weight: 700; 
            margin: 10px 0; 
        }
        
        .my-spread-num { 
            font-size: 2.0em; 
            font-weight: 700; 
            color: #7ffe94; 
            margin: 10px 0; 
        }
        
        .current-profit-num { 
            font-size: 2.0em; 
            font-weight: 700; 
            margin: 10px 0; 
        }

        .positive { color: #56d364; }
        .negative { color: #ff7b72; }

        .alert-min { animation: flash 0.8s infinite; background: #166534 !important; color: white; }
        .alert-max { animation: flash 0.8s infinite; background: #7f1d1d !important; color: white; }
        @keyframes flash { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }

        /* –°—Ç–∏–ª–∏ –¥–ª—è PnL */
        .pnl-section {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #30363d;
        }

        .pnl-line {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }

        .pnl-label {
            font-weight: 600;
        }

        .pnl-value {
            font-weight: bold;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–º–∏—Å—Å–∏–∏ */
        .commission-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #30363d;
        }

        .commission-line {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }

        .commission-label {
            font-weight: 600;
            color: #ffa657;
        }

        .commission-value {
            font-weight: bold;
        }

        /* –ù–æ–≤–∞—è —É–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –±–ª–æ–∫–∞ "–ú–æ—è –ø–æ–∑–∏—Ü–∏—è" */
        .position-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .position-row {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            gap: 10px;
        }

        .position-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 80px;
        }

        .position-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffa657;
            margin-bottom: 5px;
            text-align: center;
        }

        .position-subtitle {
            font-size: 0.8em;
            color: #8b949e;
            margin-bottom: 3px;
            text-align: center;
        }

        .position-input {
            width: 100%;
            max-width: 120px;
            margin: 0 auto;
        }

        .exchange-select {
            width: 100%;
            max-width: 120px;
            margin: 0 auto;
        }

        /* –ù–æ–≤—ã–π –±–ª–æ–∫ –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ */
        .position-size-row {
            margin: 15px 0;
            text-align: center;
        }

        .position-size-label {
            font-size: 0.9em;
            color: #8b949e;
            margin-bottom: 5px;
        }

        .position-size-input {
            width: 150px;
            margin: 0 auto;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ "–¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ñ–∏—Ç" */
        .profit-spread {
            margin-bottom: 15px;
        }

        .market-spread {
            margin-bottom: 15px;
        }

        .usdt-pnl {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #30363d;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –≤ USDT */
        .position-usdt {
            margin-top: 8px;
            font-size: 0.9em;
            color: #58a6ff;
            font-weight: bold;
            text-align: center;
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
                margin: 10px 0 15px 0;
            }
            
            .header-container {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1000;
            }
            
            .home-btn {
                left: 10px;
                padding: 4px 8px;
                font-size: 0.7em;
            }
            
            .time-block {
                height: 80px;
                margin: 0 10px 10px 10px;
            }
            
            .ntp-time {
                font-size: 2.5em;
                margin-left: 40px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ–º–æ–π */
            }
            
            .refresh-btn {
                top: 5px;
                right: 10px;
                padding: 4px 8px;
                font-size: 0.7em;
            }
            
            .funding-timer {
                font-size: 1em;
                padding: 3px 10px;
            }
            
            .main-content {
                margin-top: 140px; /* –ú–µ–Ω—å—à–∏–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
                padding: 0 10px 20px 10px;
            }
            
            .wrapper {
                display: flex;
                flex-direction: column;
                gap: 10px;
                padding: 0;
            }
            
            .block {
                height: auto;
                min-height: 450px; /* –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
                padding: 15px;
                margin: 0 0 10px 0;
            }
            
            .chart-block {
                height: 400px;
                margin: 0 0 10px 0;
            }
            
            .chartjs-block {
                height: 350px;
                margin: 0 0 10px 0;
            }
            
            .block h2 {
                font-size: 1.1em;
                margin-bottom: 10px;
            }
            
            .chart-block h2,
            .chartjs-block h2 {
                font-size: 1.2em;
            }
            
            input, button, select {
                padding: 10px 12px;
                font-size: 16px;
            }
            
            .content {
                padding: 12px;
                font-size: 0.95em;
            }
            
            .ticker-big {
                font-size: 1.3em;
            }
            
            .spread-big {
                font-size: 1.8em;
            }
            
            .my-spread-num, .current-profit-num {
                font-size: 1.7em;
            }
            
            .position-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .position-section {
                min-height: auto;
            }
            
            .position-input, .exchange-select {
                max-width: 100%;
            }
            
            .position-size-input {
                width: 100%;
            }
            
            .funding-result {
                font-size: 0.95em;
                min-height: 120px;
            }
            
            .funding-line {
                flex-direction: column;
                margin: 8px 0;
            }
            
            .funding-label, .funding-value {
                margin: 2px 0;
            }
            
            #tradingview-chart {
                min-height: 300px;
            }
            
            .chart-controls {
                flex-direction: column;
                gap: 5px;
            }
            
            .chart-btn {
                width: 100%;
            }
            
            /* Floating Menu –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .floating-menu {
                right: 10px;
                bottom: 10px;
            }
            
            .floating-btn {
                width: 50px;
                height: 50px;
                font-size: 0.8em;
            }
            
            .floating-btn::after {
                font-size: 0.7em;
                padding: 6px 8px;
                right: 60px;
            }
            
            .floating-btn:hover::after {
                right: 65px;
            }
        }

        /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 480px) {
            .time-block {
                height: 70px;
            }
            
            .ntp-time {
                font-size: 2em;
                margin-left: 35px;
            }
            
            .main-content {
                margin-top: 130px;
            }
            
            .block {
                min-height: 400px;
            }
            
            .chart-block {
                height: 350px;
            }
            
            .chartjs-block {
                height: 300px;
            }
            
            .floating-btn {
                width: 45px;
                height: 45px;
                font-size: 0.75em;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–æ—Å—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0d1117;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #58a6ff;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #79c0ff;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ */
        .active-section-indicator {
            position: fixed;
            top: 200px;
            right: 20px;
            background: #161b22;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 998;
            font-size: 0.8em;
            color: #8b949e;
            border: 1px solid #30363d;
            display: none;
        }

        .active-section-indicator.show {
            display: block;
        }

        @media (max-width: 768px) {
            .active-section-indicator {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ô –≤–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫ -->
    <div class="header-container">
        <!-- –ë–ª–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Å–∞–º–æ–º –≤–µ—Ä—Ö—É -->
        <div class="time-block">
            <button class="home-btn" onclick="goHome()">
                <span>üè†</span> –î–æ–º–æ–π
            </button>
            <button class="refresh-btn" onclick="syncNTPTime()">‚Üª –û–±–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è</button>
            <div class="ntp-time" id="ntp-clock">00:00:00</div>
            <div class="funding-timer" id="funding-timer" style="display: none;"></div>
        </div>

        <h1>Spread Alert by Artofskill</h1>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ -->
    <div class="active-section-indicator" id="active-section-indicator">
        –¢–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª: <span id="current-section">LIVE Spread</span>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <!-- –Ø–∫–æ—Ä—å –¥–ª—è Live –±–ª–æ–∫–æ–≤ -->
        <div id="live-blocks" class="anchor"></div>
        
        <div class="wrapper">
            <!-- 1. LIVE —Å–ø—Ä–µ–¥ -->
            <div class="block">
                <h2>LIVE Spread</h2>
                <input type="text" id="ticker" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–∏–∫–µ—Ä" autofocus>
                <div style="margin:10px 0; font-size: 0.9em;">
                    ‚â§ <input type="number" id="min-alert" step="0.01" value="0.80" style="width:70px;"> %
                    ‚â• <input type="number" id="max-alert" step="0.01" value="2.00" style="width:70px;"> %
                </div>
                <button id="start-btn" onclick="startMonitoring()">–°–¢–ê–†–¢</button>
                <button id="stop-btn" onclick="stopMonitoring()" style="display:none;">–°–¢–û–ü</button>
                <div class="content" id="result">–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É</div>
            </div>

            <!-- 2. –ú–æ—è –ø–æ–∑–∏—Ü–∏—è -->
            <div class="block">
                <h2>My Position</h2>
                
                <div class="position-container">
                    <!-- Long –ø–æ–∑–∏—Ü–∏—è -->
                    <div class="position-row">
                        <div class="position-section">
                            <div class="position-title">Long</div>
                            <div class="position-subtitle">–ë–∏—Ä–∂–∞</div>
                            <select id="long-exchange" class="exchange-select">
                                <option value="bybit">Bybit</option>
                                <option value="binance">Binance</option>
                            </select>
                            <div class="position-subtitle">–í—Ö–æ–¥</div>
                            <input type="number" step="0.000001" id="long-price" placeholder="0.146638" class="position-input" oninput="updatePositionUsdt()">
                        </div>
                        
                        <!-- Short –ø–æ–∑–∏—Ü–∏—è -->
                        <div class="position-section">
                            <div class="position-title">Short</div>
                            <div class="position-subtitle">–ë–∏—Ä–∂–∞</div>
                            <select id="short-exchange" class="exchange-select">
                                <option value="bybit">Bybit</option>
                                <option value="binance" selected>Binance</option>
                            </select>
                            <div class="position-subtitle">–í—Ö–æ–¥</div>
                            <input type="number" step="0.000001" id="short-price" placeholder="0.148440" class="position-input" oninput="updatePositionUsdt()">
                        </div>
                    </div>

                    <!-- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ -->
                    <div class="position-size-row">
                        <div class="position-size-label">–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ (–º–æ–Ω–µ—Ç—ã)</div>
                        <input type="number" id="position-size" placeholder="150000" class="position-size-input" oninput="updatePositionUsdt()">
                        <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ USDT -->
                        <div class="position-usdt" id="position-usdt-display">–†–∞–∑–º–µ—Ä –≤ USDT: -</div>
                    </div>
                </div>
                
                <button onclick="calcMySpread()">–†–ê–°–°–ß–ò–¢–ê–¢–¨</button>
                <div class="content" id="my-result">‚Äî</div>
            </div>

            <!-- 3. –¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ñ–∏—Ç -->
            <div class="block">
                <h2>Current Profit</h2>
                <div class="content" id="profit-result">
                    –ó–∞–ø—É—Å—Ç–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –≤–≤–µ–¥–∏ –ø–æ–∑–∏—Ü–∏—é
                </div>
            </div>

            <!-- 4. Funding Info -->
            <div class="block">
                <h2>Funding Info</h2>
                <div class="funding-result" id="funding-result">
                    –ó–∞–ø—É—Å—Ç–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                </div>
            </div>
        </div>

        <!-- –Ø–∫–æ—Ä—å –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ Chart.js -->
        <div id="history-spread" class="anchor"></div>
        
        <!-- 5. –ë–ª–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞ —Å–ø—Ä–µ–¥–∞ Chart.js -->
        <div class="chartjs-block">
            <h2>üìä –ò—Å—Ç–æ—Ä–∏—è —Å–ø—Ä–µ–¥–∞ (Chart.js) - 360 –∑–∞–ø–∏—Å–µ–π</h2>
            <div class="chart-controls">
                <button class="chart-btn update" onclick="startChartUpdates()">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
                <button class="chart-btn" onclick="stopChartUpdates()">‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                <button class="chart-btn clear" onclick="clearChartData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫</button>
                <button class="chart-btn" onclick="exportChartData()">üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            </div>
            <div class="chart-counter" id="chart-counter">
                –ó–∞–ø–∏—Å–µ–π: 0/360
            </div>
            <div class="chartjs-container">
                <canvas id="spread-chart"></canvas>
            </div>
        </div>

        <!-- –Ø–∫–æ—Ä—å –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ TradingView -->
        <div id="tradingview-chart-section" class="anchor"></div>
        
        <!-- 6. –ë–ª–æ–∫ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ TradingView -->
        <div class="chart-block">
            <h2>üìà –ì—Ä–∞—Ñ–∏–∫ —Å–ø—Ä–µ–¥–∞ –º–µ–∂–¥—É –±–∏—Ä–∂–∞–º–∏ (TradingView)</h2>
            <div class="chart-controls">
                <button class="chart-btn update" onclick="updateTradingViewChart()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫</button>
                <button class="chart-btn" onclick="openTradingView()">üåê –û—Ç–∫—Ä—ã—Ç—å –≤ TradingView</button>
                <button class="chart-btn" onclick="changeChartInterval('15')">15–º</button>
                <button class="chart-btn" onclick="changeChartInterval('60')">1—á</button>
                <button class="chart-btn" onclick="changeChartInterval('240')">4—á</button>
            </div>
            <div class="chart-container">
                <div id="tradingview-chart"></div>
            </div>
        </div>
    </div>

    <!-- Floating Menu (–ü–ª–∞–≤–∞—é—â–µ–µ –º–µ–Ω—é) -->
    <div class="floating-menu">
        <button class="floating-btn live" data-tooltip="LIVE Spread" onclick="scrollToSection('live-blocks')">
            LIVE
        </button>
        <button class="floating-btn history" data-tooltip="–ò—Å—Ç–æ—Ä–∏—è —Å–ø—Ä–µ–¥–∞" onclick="scrollToSection('history-spread')">
            HS
        </button>
        <button class="floating-btn tradingview" data-tooltip="TradingView Chart" onclick="scrollToSection('tradingview-chart-section')">
            TV
        </button>
    </div>

    <!-- JavaScript -->
    <script>
        // NTP-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
        let ntpOffset = 0;
        let fundingTimerActive = false;
        let fundingTimerInterval = null;
        let currentTimerFundingSpread = 0;
        let currentTicker = '';
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ Chart.js
        let spreadChart = null;
        let chartData = {
            labels: [],
            datasets: [{
                label: '–°–ø—Ä–µ–¥ %',
                data: [],
                borderColor: '#58a6ff',
                backgroundColor: 'rgba(88, 166, 255, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: function(context) {
                    const value = context.dataset.data[context.dataIndex];
                    return value >= 0 ? '#56d364' : '#ff7b72';
                },
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2
            }]
        };
        let maxDataPoints = 360; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 60 –¥–æ 360
        let chartUpdateInterval = null;
        let isChartRecording = false;
        let currentChartInterval = '15'; // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è TradingView

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ Chart.js
        function initChart() {
            const ctx = document.getElementById('spread-chart').getContext('2d');
            
            spreadChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#161b22',
                            titleColor: '#ffa657',
                            bodyColor: '#c9d1d9',
                            borderColor: '#30363d',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `–°–ø—Ä–µ–¥: ${context.parsed.y.toFixed(3)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: '#30363d',
                                borderColor: '#30363d'
                            },
                            ticks: {
                                color: '#8b949e',
                                maxTicksLimit: 10,
                                callback: function(value, index, values) {
                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–∫–∏ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
                                    if (values.length <= 20) return this.getLabelForValue(value);
                                    if (index % Math.floor(values.length / 10) === 0 || index === values.length - 1) {
                                        return this.getLabelForValue(value);
                                    }
                                    return '';
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: '#30363d',
                                borderColor: '#30363d'
                            },
                            ticks: {
                                color: '#8b949e',
                                callback: function(value) {
                                    return value.toFixed(2) + '%';
                                }
                            },
                            suggestedMin: -2,
                            suggestedMax: 2
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    elements: {
                        point: {
                            radius: 3,
                            hoverRadius: 5
                        }
                    },
                    animation: {
                        duration: 300
                    }
                }
            });
            
            updateChartCounter();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        function updateChart(spreadValue) {
            if (!spreadChart) return;
            
            const now = new Date();
            const timeLabel = now.getHours().toString().padStart(2, '0') + ':' + 
                             now.getMinutes().toString().padStart(2, '0') + ':' + 
                             now.getSeconds().toString().padStart(2, '0');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Ç–æ—á–∫—É
            chartData.labels.push(timeLabel);
            chartData.datasets[0].data.push(spreadValue);
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ç–æ—á–∫–∏, –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
            if (chartData.labels.length > maxDataPoints) {
                chartData.labels.shift();
                chartData.datasets[0].data.shift();
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–∏ Y
            const dataValues = chartData.datasets[0].data;
            if (dataValues.length > 0) {
                const minValue = Math.min(...dataValues);
                const maxValue = Math.max(...dataValues);
                const padding = Math.max(Math.abs(minValue), Math.abs(maxValue)) * 0.2;
                
                spreadChart.options.scales.y.min = minValue - padding;
                spreadChart.options.scales.y.max = maxValue + padding;
            }
            
            spreadChart.update('none'); // 'none' –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
            updateChartCounter();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Ç–æ—á–µ–∫
        function updateChartCounter() {
            const count = chartData.labels.length;
            const counterElement = document.getElementById('chart-counter');
            counterElement.textContent = `–ó–∞–ø–∏—Å–µ–π: ${count}/${maxDataPoints}`;
            
            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É
            if (count >= maxDataPoints * 0.9) {
                counterElement.style.color = '#ff7b72';
            } else if (count >= maxDataPoints * 0.7) {
                counterElement.style.color = '#ffa657';
            } else if (count >= maxDataPoints * 0.5) {
                counterElement.style.color = '#ffd33d';
            } else {
                counterElement.style.color = '#8b949e';
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞
        function exportChartData() {
            if (chartData.labels.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!');
                return;
            }
            
            let csvContent = "–í—Ä–µ–º—è,–°–ø—Ä–µ–¥(%)\n";
            for (let i = 0; i < chartData.labels.length; i++) {
                csvContent += `${chartData.labels[i]},${chartData.datasets[0].data[i].toFixed(3)}\n`;
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `spread_history_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const exportBtn = document.querySelector('.chart-btn[onclick="exportChartData()"]');
            const originalText = exportBtn.textContent;
            exportBtn.textContent = '‚úì –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!';
            exportBtn.style.background = '#56d364';
            
            setTimeout(() => {
                exportBtn.textContent = originalText;
                exportBtn.style.background = '#58a6ff';
            }, 2000);
        }

        // –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        function startChartUpdates() {
            if (isChartRecording) return;
            
            if (!monitorActive) {
                alert('–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–ø—Ä–µ–¥–∞ —Å–Ω–∞—á–∞–ª–∞!');
                return;
            }
            
            isChartRecording = true;
            const updateBtn = document.querySelector('.chartjs-block .chart-controls .update');
            updateBtn.textContent = '‚è∫Ô∏è –ó–∞–ø–∏—Å—å...';
            updateBtn.style.background = '#ff7b72';
            updateChartCounter();
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        function stopChartUpdates() {
            isChartRecording = false;
            const updateBtn = document.querySelector('.chartjs-block .chart-controls .update');
            updateBtn.textContent = '‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å';
            updateBtn.style.background = '#56d364';
        }

        // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞
        function clearChartData() {
            if (chartData.labels.length === 0) {
                alert('–ì—Ä–∞—Ñ–∏–∫ —É–∂–µ –ø—É—Å—Ç!');
                return;
            }
            
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞?')) {
                chartData.labels = [];
                chartData.datasets[0].data = [];
                
                if (spreadChart) {
                    spreadChart.update();
                }
                
                updateChartCounter();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                const clearBtn = document.querySelector('.chart-btn.clear');
                const originalText = clearBtn.textContent;
                clearBtn.textContent = '‚úì –û—á–∏—â–µ–Ω–æ!';
                clearBtn.style.background = '#56d364';
                
                setTimeout(() => {
                    clearBtn.textContent = originalText;
                    clearBtn.style.background = '#ff7b72';
                }, 2000);
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –≥—Ä–∞—Ñ–∏–∫–∞ TradingView
        function changeChartInterval(interval) {
            currentChartInterval = interval;
            updateTradingViewChart();
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
            document.querySelectorAll('.chart-block .chart-btn').forEach(btn => {
                if (btn.textContent.includes('–º') || btn.textContent.includes('—á')) {
                    btn.style.background = '#58a6ff';
                }
            });
            event.target.style.background = '#7ffe94';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ TradingView
        function updateTradingViewChart() {
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            if (!ticker) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–∏–∫–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞!');
                return;
            }
            
            loadTradingViewChart(ticker);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const updateBtn = document.querySelector('.chart-block .chart-btn.update');
            const originalText = updateBtn.textContent;
            updateBtn.textContent = '‚úì –ì—Ä–∞—Ñ–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω!';
            updateBtn.style.background = '#56d364';
            
            setTimeout(() => {
                updateBtn.textContent = originalText;
                updateBtn.style.background = '#56d364';
            }, 2000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞ TradingView
        function loadTradingViewChart(ticker) {
            if (!ticker || ticker.trim() === '') {
                document.getElementById('tradingview-chart').innerHTML = 
                    '<div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #8b949e;">–í–≤–µ–¥–∏—Ç–µ —Ç–∏–∫–µ—Ä –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</div>';
                return;
            }
            
            const symbol = ticker.toUpperCase() + 'USDT';
            const expression = `BINANCE:${symbol}.P - BYBIT:${symbol}.P`;
            
            currentTicker = symbol;
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            document.getElementById('tradingview-chart').innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–∂–µ—Ç TradingView
            new TradingView.widget({
                "container_id": "tradingview-chart",
                "width": "100%",
                "height": "100%",
                "symbol": expression,
                "interval": currentChartInterval,
                "timezone": "exchange",
                "theme": "dark",
                "style": "1",
                "locale": "ru",
                "toolbar_bg": "#0d1117",
                "enable_publishing": false,
                "allow_symbol_change": false,
                "hide_side_toolbar": false,
                "details": true,
                "studies": [
                    "MASimple@tv-basicstudies",
                    "Volume@tv-basicstudies"
                ],
                "show_popup_button": true,
                "popup_width": "1000",
                "popup_height": "650"
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ TradingView
        function openTradingView() {
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            if (!ticker) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–∏–∫–µ—Ä –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≥—Ä–∞—Ñ–∏–∫–∞!');
                return;
            }
            
            const symbol = ticker + 'USDT';
            const expression = `BINANCE:${symbol}.P - BYBIT:${symbol}.P`;
            const url = `https://www.tradingview.com/chart/?symbol=${encodeURIComponent(expression)}&interval=${currentChartInterval}`;
            
            window.open(url, '_blank');
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ü–∏—è–º
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É —Å —É—á–µ—Ç–æ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                const headerHeight = document.querySelector('.header-container').offsetHeight;
                const elementPosition = element.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerHeight - 20;
                
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–π —Ä–∞–∑–¥–µ–ª–∞
                updateActiveSection(sectionId);
                
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                document.querySelectorAll('.floating-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
        function updateActiveSection(sectionId) {
            const indicator = document.getElementById('active-section-indicator');
            const sectionText = document.getElementById('current-section');
            
            let sectionName = '';
            switch(sectionId) {
                case 'live-blocks':
                    sectionName = 'LIVE Spread';
                    break;
                case 'history-spread':
                    sectionName = '–ò—Å—Ç–æ—Ä–∏—è —Å–ø—Ä–µ–¥–∞';
                    break;
                case 'tradingview-chart-section':
                    sectionName = 'TradingView Chart';
                    break;
                default:
                    sectionName = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            }
            
            sectionText.textContent = sectionName;
            indicator.classList.add('show');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 3000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —Å–∞–π—Ç
        function goHome() {
            window.open('https://artofskill.github.io', '_blank');
        }

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
        window.addEventListener('scroll', function() {
            const scrollPosition = window.scrollY + 200; // –° —É—á–µ—Ç–æ–º –æ—Ç—Å—Ç—É–ø–æ–≤
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ —Å–µ–∫—Ü–∏–π
            const liveSection = document.getElementById('live-blocks');
            const historySection = document.getElementById('history-spread');
            const tvSection = document.getElementById('tradingview-chart-section');
            
            if (!liveSection || !historySection || !tvSection) return;
            
            const liveOffset = liveSection.offsetTop;
            const historyOffset = historySection.offsetTop;
            const tvOffset = tvSection.offsetTop;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å–µ–∫—Ü–∏—é
            let currentSection = 'live-blocks';
            if (scrollPosition >= tvOffset) {
                currentSection = 'tradingview-chart-section';
            } else if (scrollPosition >= historyOffset) {
                currentSection = 'history-spread';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ –ø–ª–∞–≤–∞—é—â–µ–º –º–µ–Ω—é
            document.querySelectorAll('.floating-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (currentSection === 'live-blocks') {
                document.querySelector('.floating-btn.live').classList.add('active');
            } else if (currentSection === 'history-spread') {
                document.querySelector('.floating-btn.history').classList.add('active');
            } else if (currentSection === 'tradingview-chart-section') {
                document.querySelector('.floating-btn.tradingview').classList.add('active');
            }
        });

        async function syncNTPTime() {
            try {
                const start = Date.now();
                const response = await fetch('https://worldtimeapi.org/api/ip');
                const data = await response.json();
                const end = Date.now();
                
                const serverTime = new Date(data.utc_datetime).getTime();
                const rtt = end - start;
                ntpOffset = serverTime - start - (rtt / 2);
                
                console.log('NTP —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –ö–æ—Ä—Ä–µ–∫—Ü–∏—è: ' + ntpOffset + 'ms');
                updateNTPClock();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                const refreshBtn = document.querySelector('.refresh-btn');
                const originalText = refreshBtn.textContent;
                refreshBtn.textContent = '‚úì –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ!';
                refreshBtn.style.background = '#56d364';
                
                setTimeout(() => {
                    refreshBtn.textContent = originalText;
                    refreshBtn.style.background = '#58a6ff';
                }, 2000);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ NTP —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
                
                const refreshBtn = document.querySelector('.refresh-btn');
                const originalText = refreshBtn.textContent;
                refreshBtn.textContent = '‚úó –û—à–∏–±–∫–∞!';
                refreshBtn.style.background = '#ff7b72';
                
                setTimeout(() => {
                    refreshBtn.textContent = originalText;
                    refreshBtn.style.background = '#58a6ff';
                }, 2000);
            }
        }

        function getNTPTime() {
            return new Date(Date.now() + ntpOffset);
        }

        function updateNTPClock() {
            const now = getNTPTime();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            document.getElementById('ntp-clock').textContent = `${hours}:${minutes}:${seconds}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ —Ñ–∞–Ω–¥–∏–Ω–≥–∞
        function updateFundingTimer(nextFundingTime, fundingSpread) {
            const now = Date.now();
            const timeLeft = nextFundingTime - now;
            
            if (timeLeft <= 0) {
                document.getElementById('funding-timer').style.display = 'none';
                fundingTimerActive = false;
                if (fundingTimerInterval) {
                    clearInterval(fundingTimerInterval);
                }
                return;
            }
            
            const hours = Math.floor(timeLeft / 3600000);
            const minutes = Math.floor((timeLeft % 3600000) / 60000);
            const seconds = Math.floor((timeLeft % 60000) / 1000);
            
            const timerText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω—å—à–µ 1 —á–∞—Å–∞
            if (timeLeft <= 3600000) {
                const timerElement = document.getElementById('funding-timer');
                timerElement.textContent = `–§–∞–Ω–¥–∏–Ω–≥ —á–µ—Ä–µ–∑: ${timerText}`;
                timerElement.style.display = 'block';
                
                if (fundingSpread !== currentTimerFundingSpread) {
                    currentTimerFundingSpread = fundingSpread;
                    
                    if (fundingSpread >= 0) {
                        timerElement.className = 'funding-timer green';
                    } else {
                        timerElement.className = 'funding-timer red';
                    }
                }
                
                fundingTimerActive = true;
                
                if (!fundingTimerInterval) {
                    fundingTimerInterval = setInterval(() => {
                        updateFundingTimer(nextFundingTime, currentTimerFundingSpread);
                    }, 1000);
                }
            } else {
                document.getElementById('funding-timer').style.display = 'none';
                fundingTimerActive = false;
                if (fundingTimerInterval) {
                    clearInterval(fundingTimerInterval);
                    fundingTimerInterval = null;
                }
            }
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        syncNTPTime();
        setInterval(syncNTPTime, 300000);
        setInterval(updateNTPClock, 1000);

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤ 00:00:00
        function msToTime(ms) {
            if (ms <= 0) return "00:00:00";
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –≤ USDT
        function updatePositionUsdt() {
            const positionSize = parseFloat(document.getElementById('position-size').value);
            const shortPrice = parseFloat(document.getElementById('short-price').value);
            const longPrice = parseFloat(document.getElementById('long-price').value);
            
            if (positionSize && shortPrice) {
                const positionUsdt = positionSize * shortPrice;
                document.getElementById('position-usdt-display').innerHTML = 
                    `–†–∞–∑–º–µ—Ä –≤ USDT: <strong>${positionUsdt.toFixed(2)} USDT</strong>`;
            } else {
                document.getElementById('position-usdt-display').innerHTML = 
                    '–†–∞–∑–º–µ—Ä –≤ USDT: -';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω
        document.getElementById('short-price').addEventListener('input', updatePositionUsdt);
        document.getElementById('long-price').addEventListener('input', updatePositionUsdt);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –ø–æ–∑–∏—Ü–∏–∏
        function calculateCommission() {
            const positionSize = parseFloat(document.getElementById('position-size').value);
            const longPrice = parseFloat(document.getElementById('long-price').value);
            const shortPrice = parseFloat(document.getElementById('short-price').value);
            
            if (!positionSize || !longPrice || !shortPrice) {
                return null;
            }
            
            const longPositionUsdt = positionSize * longPrice;
            const shortPositionUsdt = positionSize * shortPrice;
            const totalPositionUsdt = longPositionUsdt + shortPositionUsdt;
            const commissionUsdt = totalPositionUsdt * 0.0025;
            
            return {
                longPositionUsdt: longPositionUsdt,
                shortPositionUsdt: shortPositionUsdt,
                totalPositionUsdt: totalPositionUsdt,
                commissionUsdt: commissionUsdt
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ñ–∞–Ω–¥–∏–Ω–≥–∞ –≤ USDT
        function calculateFundingUsdt(fundingRatePercent, exchange, positionSize) {
            if (!positionSize || positionSize <= 0) return 0;
            
            let price = 0;
            if (exchange === 'long') {
                price = parseFloat(document.getElementById('long-price').value);
            } else if (exchange === 'short') {
                price = parseFloat(document.getElementById('short-price').value);
            }
            
            if (!price) return 0;
            
            const positionUsdt = positionSize * price;
            const fundingUsdt = (fundingRatePercent * positionUsdt) / 100;
            
            return fundingUsdt;
        }

        let audioContext;
        function playBeep(freq = 600, duration = 300) {
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioContext.createOscillator();
            osc.type = 'sine';
            osc.frequency.value = freq;
            const gain = audioContext.createGain();
            gain.gain.value = 0.3;
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start();
            osc.stop(audioContext.currentTime + duration/1000);
        }
        function playLow() { playBeep(400, 500); setTimeout(() => playBeep(400, 500), 600); }
        function playHigh() { playBeep(900, 200); setTimeout(() => playBeep(900, 200), 300); setTimeout(() => playBeep(900, 200), 600); }

        let monitorActive = false;
        let lastPrices = { bybit: null, binance: null };
        let myLongPrice = 0;
        let myShortPrice = 0;
        let myLongExchange = 'bybit';
        let myShortExchange = 'binance';
        let mySpread = 0;
        let positionSize = 0;
        let currentFundingSpread = 0;
        let nextFundingTime = 0;

        async function getPrices(symbol) {
            try {
                const [bybitResp, binanceResp] = await Promise.all([
                    fetch('https://api.bybit.com/v5/market/tickers?category=linear'),
                    fetch('https://fapi.binance.com/fapi/v1/premiumIndex')
                ]);
                const bybitData = await bybitResp.json();
                const binanceData = await binanceResp.json();

                const bybitTicker = bybitData.result.list.find(t => t.symbol === symbol);
                const binanceTicker = binanceData.find(t => t.symbol === symbol);

                if (!bybitTicker || !binanceTicker) return null;

                return {
                    bybitPrice: parseFloat(bybitTicker.markPrice || bybitTicker.lastPrice),
                    binancePrice: parseFloat(binanceTicker.markPrice),
                    bybitRate: parseFloat(bybitTicker.fundingRate) * 100,
                    binanceRate: parseFloat(binanceTicker.lastFundingRate) * 100,
                    bybitNext: parseInt(bybitTicker.nextFundingTime),
                    binanceNext: parseInt(binanceTicker.nextFundingTime)
                };
            } catch (e) {
                return null;
            }
        }

        function getInterval(nextTime) {
            const now = Date.now();
            const diff = (nextTime - now) / 3600000;
            if (Math.abs(diff - 1) < 0.5 || Math.abs(diff - 25) < 0.5) return "1-—á–∞—Å–æ–≤–æ–π";
            if (Math.abs(diff - 4) < 0.5 || Math.abs(diff - 28) < 0.5) return "4-—á–∞—Å–æ–≤–æ–π";
            return "8-—á–∞—Å–æ–≤–æ–π";
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –±–∏—Ä–∂–µ
        function getCurrentPrice(exchange) {
            if (exchange === 'bybit') {
                return lastPrices.bybit;
            } else if (exchange === 'binance') {
                return lastPrices.binance;
            }
            return null;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–Ω–¥–∏–Ω–≥–∞ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –±–∏—Ä–∂–µ
        function getFundingData(exchange, data) {
            if (exchange === 'bybit') {
                return {
                    rate: data.bybitRate,
                    nextTime: data.bybitNext,
                    time: msToTime(data.bybitNext - Date.now()),
                    interval: getInterval(data.bybitNext)
                };
            } else if (exchange === 'binance') {
                return {
                    rate: data.binanceRate,
                    nextTime: data.binanceNext,
                    time: msToTime(data.binanceNext - Date.now()),
                    interval: getInterval(data.binanceNext)
                };
            }
            return null;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ PnL —Å —É—á–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂
        function calculatePnL() {
            if (!myLongPrice || !myShortPrice || !lastPrices.bybit || !lastPrices.binance) {
                return null;
            }

            const longCurrentPrice = getCurrentPrice(myLongExchange);
            const shortCurrentPrice = getCurrentPrice(myShortExchange);
            
            if (!longCurrentPrice || !shortCurrentPrice) return null;

            const longPnLPercent = ((longCurrentPrice - myLongPrice) / myLongPrice * 100).toFixed(3);
            const shortPnLPercent = ((myShortPrice - shortCurrentPrice) / myShortPrice * 100).toFixed(3);
            
            let longPnLUsdt = 0;
            let shortPnLUsdt = 0;
            let totalPnLUsdt = 0;
            
            if (positionSize > 0) {
                longPnLUsdt = (longCurrentPrice - myLongPrice) * positionSize;
                shortPnLUsdt = (myShortPrice - shortCurrentPrice) * positionSize;
                totalPnLUsdt = longPnLUsdt + shortPnLUsdt;
            }
            
            return {
                longPnLPercent: longPnLPercent,
                shortPnLPercent: shortPnLPercent,
                longCurrentPrice: longCurrentPrice,
                shortCurrentPrice: shortCurrentPrice,
                longPnLUsdt: longPnLUsdt,
                shortPnLUsdt: shortPnLUsdt,
                totalPnLUsdt: totalPnLUsdt
            };
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ —Å PnL –∏ –∫–æ–º–∏—Å—Å–∏–µ–π
        function updatePositionDisplay() {
            if (!myLongPrice || !myShortPrice) {
                document.getElementById('my-result').innerHTML = '–í–≤–µ–¥–∏ –æ–±–µ —Ü–µ–Ω—ã';
                return;
            }

            const pnlData = calculatePnL();
            const commissionData = calculateCommission();
            
            let pnlHtml = '';
            if (pnlData) {
                pnlHtml = `
                    <div class="pnl-section">
                        <div class="pnl-line">
                            <span class="pnl-label">Long PnL (${myLongExchange.toUpperCase()}):</span>
                            <span class="pnl-value" style="color:${pnlData.longPnLPercent >= 0 ? '#56d364' : '#ff7b72'}">
                                ${pnlData.longPnLPercent >= 0 ? '+' : ''}${pnlData.longPnLPercent}%
                            </span>
                        </div>
                        <div class="pnl-line">
                            <span class="pnl-label">Short PnL (${myShortExchange.toUpperCase()}):</span>
                            <span class="pnl-value" style="color:${pnlData.shortPnLPercent >= 0 ? '#56d364' : '#ff7b72'}">
                                ${pnlData.shortPnLPercent >= 0 ? '+' : ''}${pnlData.shortPnLPercent}%
                            </span>
                        </div>
                        <div class="pnl-line">
                            <span class="pnl-label">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ Long:</span>
                            <span class="pnl-value">${pnlData.longCurrentPrice.toFixed(6)}</span>
                        </div>
                        <div class="pnl-line">
                            <span class="pnl-label">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ Short:</span>
                            <span class="pnl-value">${pnlData.shortCurrentPrice.toFixed(6)}</span>
                        </div>
                    </div>
                `;
            }
            
            let commissionHtml = '';
            if (commissionData) {
                commissionHtml = `
                    <div class="commission-section">
                        <div class="commission-line">
                            <span class="commission-label">–ö–æ–º–∏—Å—Å–∏—è –∑–∞ –ø–æ–∑–∏—Ü–∏–∏:</span>
                            <span class="commission-value">${commissionData.commissionUsdt.toFixed(2)} USDT</span>
                        </div>
                        <div style="font-size: 0.8em; color: #8b949e; margin-top: 3px;">
                            Long: ${commissionData.longPositionUsdt.toFixed(2)} USDT + Short: ${commissionData.shortPositionUsdt.toFixed(2)} USDT = ${commissionData.totalPositionUsdt.toFixed(2)} USDT √ó 0.25%
                        </div>
                    </div>
                `;
            }

            document.getElementById('my-result').innerHTML = `
                <div>Long (${myLongExchange.toUpperCase()}) ${myLongPrice}</div>
                <div>Short (${myShortExchange.toUpperCase()}) ${myShortPrice}</div>
                <div class="my-spread-num" style="color:${mySpread > 0 ? '#56d364' : '#ff7b72'}">
                    ${mySpread > 0 ? '+' : ''}${mySpread}%
                </div>
                ${pnlHtml}
                ${commissionHtml}
            `;
            
            updatePositionUsdt();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä—ã–Ω–æ—á–Ω–æ–≥–æ —Å–ø—Ä–µ–¥–∞ –º–µ–∂–¥—É –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –±–∏—Ä–∂–∞–º–∏
        function calculateMarketSpread() {
            if (!lastPrices.bybit || !lastPrices.binance) return null;
            
            const longCurrentPrice = getCurrentPrice(myLongExchange);
            const shortCurrentPrice = getCurrentPrice(myShortExchange);
            
            if (!longCurrentPrice || !shortCurrentPrice) return null;
            
            const marketSpread = ((shortCurrentPrice - longCurrentPrice) / longCurrentPrice * 100).toFixed(3);
            return marketSpread;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Funding Info
        function updateFundingInfo(data) {
            if (!data) return;
            
            const longFunding = getFundingData(myLongExchange, data);
            const shortFunding = getFundingData(myShortExchange, data);
            
            if (!longFunding || !shortFunding) return;
            
            const fundingSpread = (shortFunding.rate - longFunding.rate).toFixed(4);
            currentFundingSpread = parseFloat(fundingSpread);
            
            nextFundingTime = Math.min(longFunding.nextTime, shortFunding.nextTime);
            updateFundingTimer(nextFundingTime, currentFundingSpread);
            
            const longFundingUsdt = calculateFundingUsdt(longFunding.rate, 'long', positionSize);
            const shortFundingUsdt = calculateFundingUsdt(shortFunding.rate, 'short', positionSize);
            
            const longFundingDisplayUsdt = longFundingUsdt * -1;
            const shortFundingDisplayUsdt = shortFundingUsdt;
            const totalFundingUsdt = shortFundingUsdt - longFundingUsdt;
            
            document.getElementById('funding-result').innerHTML = `
                <div class="funding-line">
                    <span class="funding-label">Long funding (${myLongExchange.toUpperCase()}):</span>
                    <div>
                        <span class="funding-value funding-${longFunding.rate >= 0 ? 'positive' : 'negative'}">
                            ${longFunding.rate.toFixed(5)}%
                        </span>
                        ${positionSize > 0 ? `<div class="funding-usdt" style="color:${longFundingDisplayUsdt >= 0 ? '#56d364' : '#ff7b72'}">${longFundingDisplayUsdt >= 0 ? '+' : ''}${longFundingDisplayUsdt.toFixed(4)} USDT</div>` : ''}
                    </div>
                </div>
                <div class="funding-line">
                    <span class="funding-label">‚Üí —á–µ—Ä–µ–∑</span>
                    <span class="funding-value">${longFunding.time} (${longFunding.interval})</span>
                </div>
                <div class="funding-line">
                    <span class="funding-label">Short funding (${myShortExchange.toUpperCase()}):</span>
                    <div>
                        <span class="funding-value funding-${shortFunding.rate >= 0 ? 'positive' : 'negative'}">
                            ${shortFunding.rate.toFixed(5)}%
                        </span>
                        ${positionSize > 0 ? `<div class="funding-usdt" style="color:${shortFundingDisplayUsdt >= 0 ? '#56d364' : '#ff7b72'}">${shortFundingDisplayUsdt >= 0 ? '+' : ''}${shortFundingDisplayUsdt.toFixed(4)} USDT</div>` : ''}
                    </div>
                </div>
                <div class="funding-line">
                    <span class="funding-label">‚Üí —á–µ—Ä–µ–∑</span>
                    <span class="funding-value">${shortFunding.time} (${shortFunding.interval})</span>
                </div>
                <div class="funding-summary">
                    –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å —Ñ–∞–Ω–¥–∏–Ω–≥–∞ (short - long): <strong style="color:${fundingSpread > 0 ? '#56d364' : '#ff7b72'}">
                        ${fundingSpread > 0 ? '+' : ''}${fundingSpread}%
                    </strong>
                    ${positionSize > 0 ? `<div style="margin-top: 5px; font-size: 0.9em; color: ${totalFundingUsdt >= 0 ? '#56d364' : '#ff7b72'}">${totalFundingUsdt >= 0 ? '+' : ''}${totalFundingUsdt.toFixed(4)} USDT</div>` : ''}
                </div>
            `;
        }

        async function monitorLoop() {
            if (!monitorActive) return;

            const symbol = document.getElementById('ticker').value.trim().toUpperCase() + 'USDT';
            const minAlert = parseFloat(document.getElementById('min-alert').value) || 0;
            const maxAlert = parseFloat(document.getElementById('max-alert').value) || 999;

            const data = await getPrices(symbol);
            if (!data) {
                document.getElementById('result').innerHTML = `<span style="color:#ff7b72">–ü–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</span>`;
                setTimeout(monitorLoop, 3000);
                return;
            }

            if (data.bybitPrice !== lastPrices.bybit || data.binancePrice !== lastPrices.binance) {
                lastPrices = { bybit: data.bybitPrice, binance: data.binancePrice };

                // –†–∞—Å—á–µ—Ç —Å–ø—Ä–µ–¥–∞ –º–µ–∂–¥—É Bybit –∏ Binance
                const diff = ((data.bybitPrice - data.binancePrice) / data.binancePrice * 100);
                const absDiff = Math.abs(diff).toFixed(3);
                const sign = diff > 0 ? '' : '-';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ Chart.js, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –∑–∞–ø–∏—Å—å
                if (isChartRecording) {
                    updateChart(diff);
                }

                let extra = '';
                let className = '';

                if (absDiff <= minAlert && minAlert > 0) {
                    playLow();
                    className = 'alert-min';
                    extra = '<br>–°–ü–†–ï–î ‚â§ –ú–ò–ù–ò–ú–£–ú!';
                }
                if (absDiff >= maxAlert) {
                    playHigh();
                    className = 'alert-max';
                    extra = '<br>–°–ü–†–ï–î ‚â• –ú–ê–ö–°–ò–ú–£–ú!';
                }

                document.getElementById('result').className = 'content ' + className;
                document.getElementById('result').innerHTML = `
                    <div class="ticker-big">${symbol.replace('USDT','')}</div>
                    Bybit: <strong>${data.bybitPrice.toFixed(6)}</strong><br>
                    Binance: <strong>${data.binancePrice.toFixed(6)}</strong><br><br>
                    <span class="spread-big" style="color:${diff >= 0 ? '#56d364' : '#ff7b72'}">
                        ${sign}${absDiff}%
                    </span>
                    ${extra}
                `;

                updateFundingInfo(data);
                updatePositionDisplay();
                updateProfit();
            }

            setTimeout(monitorLoop, 800);
        }

        function calcMySpread() {
            const longPrice = parseFloat(document.getElementById('long-price').value);
            const shortPrice = parseFloat(document.getElementById('short-price').value);
            const longExchange = document.getElementById('long-exchange').value;
            const shortExchange = document.getElementById('short-exchange').value;
            const size = parseFloat(document.getElementById('position-size').value);

            if (!longPrice || !shortPrice) {
                document.getElementById('my-result').innerHTML = '–í–≤–µ–¥–∏ –æ–±–µ —Ü–µ–Ω—ã';
                mySpread = 0;
                updateProfit();
                return;
            }

            myLongPrice = longPrice;
            myShortPrice = shortPrice;
            myLongExchange = longExchange;
            myShortExchange = shortExchange;
            positionSize = size || 0;
            
            mySpread = ((shortPrice - longPrice) / longPrice * 100).toFixed(3);

            updatePositionDisplay();
            updateProfit();
        }

        function updateProfit() {
            if (mySpread === 0) {
                document.getElementById('profit-result').innerHTML = '–í–≤–µ–¥–∏ —Å–≤–æ—é –ø–æ–∑–∏—Ü–∏—é';
                return;
            }

            const marketSpread = calculateMarketSpread();
            
            if (!marketSpread) {
                document.getElementById('profit-result').innerHTML = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ü–µ–Ω–∞–º';
                return;
            }

            const profit = (mySpread - marketSpread).toFixed(3);
            const color = profit > 0 ? '#56d364' : '#ff7b72';

            const pnlData = calculatePnL();
            let usdtHtml = '';
            
            if (pnlData && positionSize > 0) {
                usdtHtml = `
                    <div class="usdt-pnl">
                        <div class="pnl-line">
                            <span class="pnl-label">Long PnL (USDT):</span>
                            <span class="pnl-value" style="color:${pnlData.longPnLUsdt >= 0 ? '#56d364' : '#ff7b72'}">
                                ${pnlData.longPnLUsdt >= 0 ? '+' : ''}${pnlData.longPnLUsdt.toFixed(2)} USDT
                            </span>
                        </div>
                        <div class="pnl-line">
                            <span class="pnl-label">Short PnL (USDT):</span>
                            <span class="pnl-value" style="color:${pnlData.shortPnLUsdt >= 0 ? '#56d364' : '#ff7b72'}">
                                ${pnlData.shortPnLUsdt >= 0 ? '+' : ''}${pnlData.shortPnLUsdt.toFixed(2)} USDT
                            </span>
                        </div>
                        <div class="pnl-line">
                            <span class="pnl-label">Total PnL (USDT):</span>
                            <span class="pnl-value" style="color:${pnlData.totalPnLUsdt >= 0 ? '#56d364' : '#ff7b72'}">
                                ${pnlData.totalPnLUsdt >= 0 ? '+' : ''}${pnlData.totalPnLUsdt.toFixed(2)} USDT
                            </span>
                        </div>
                    </div>
                `;
            }

            document.getElementById('profit-result').innerHTML = `
                <div class="profit-spread">–¢–≤–æ–π —Å–ø—Ä–µ–¥: <strong style="color:#7ffe94">${mySpread > 0 ? '+' : ''}${mySpread}%</strong></div>
                <div class="market-spread">–†—ã–Ω–æ—á–Ω—ã–π —Å–ø—Ä–µ–¥ (${myLongExchange.toUpperCase()}‚Üí${myShortExchange.toUpperCase()}): <strong>${marketSpread > 0 ? '+' : ''}${marketSpread}%</strong></div>
                <div class="current-profit-num" style="color:${color}">
                    ${profit > 0 ? '+' : ''}${profit}%
                </div>
                <div style="margin-top:8px;">
                    ${profit > 0 ? '–ú–æ–∂–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å!' : '–ñ–¥—ë–º —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è'}
                </div>
                ${usdtHtml}
            `;
        }

        function startMonitoring() {
            if (monitorActive) return;
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            if (!ticker) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–∏–∫–µ—Ä!');
            monitorActive = true;
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('stop-btn').style.display = 'inline-block';
            document.getElementById('result').innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            document.getElementById('funding-result').innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            lastPrices = { bybit: null, binance: null };
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ TradingView –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
            loadTradingViewChart(ticker);
            
            monitorLoop();
        }

        function stopMonitoring() {
            monitorActive = false;
            document.getElementById('start-btn').style.display = 'inline-block';
            document.getElementById('stop-btn').style.display = 'none';
            document.getElementById('result').innerHTML = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            document.getElementById('result').className = 'content';
            document.getElementById('funding-result').innerHTML = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            document.getElementById('profit-result').innerHTML = '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–ø–∏—Å—å –≥—Ä–∞—Ñ–∏–∫–∞
            stopChartUpdates();
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä —Ñ–∞–Ω–¥–∏–Ω–≥–∞
            document.getElementById('funding-timer').style.display = 'none';
            fundingTimerActive = false;
            if (fundingTimerInterval) {
                clearInterval(fundingTimerInterval);
                fundingTimerInterval = null;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            updatePositionUsdt();
            initChart(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫ Chart.js
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–ª–æ–∫–µ –≥—Ä–∞—Ñ–∏–∫–∞ TradingView
            document.getElementById('tradingview-chart').innerHTML = 
                '<div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #8b949e; text-align: center; padding: 20px;">' +
                '<div>' +
                '<div style="font-size: 1.5em; margin-bottom: 10px;">üìà</div>' +
                '<div style="font-weight: bold; margin-bottom: 5px;">–ì—Ä–∞—Ñ–∏–∫ —Å–ø—Ä–µ–¥–∞ –º–µ–∂–¥—É –±–∏—Ä–∂–∞–º–∏</div>' +
                '<div>–í–≤–µ–¥–∏—Ç–µ —Ç–∏–∫–µ—Ä –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–¢–ê–†–¢"<br>–∏–ª–∏ –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫"</div>' +
                '</div>' +
                '</div>';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É LIVE –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            document.querySelector('.floating-btn.live').classList.add('active');
        });
    </script>
    
    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
</body>
</html>
